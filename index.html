<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Shopping cart</title>
		<link rel="stylesheet" type="text/css" href="css/main.css">
	</head>
	<body>
		<h1>shopping cart</h1>

		<div>
			<ul>
				<li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">Apple 1.22</a></li>
				<li><a class="add-to-cart" href="#" data-name="Banana" data-price="2.30">Banana 2.30</a></li>
				<li><a class="add-to-cart" href="#" data-name="Mango" data-price="3.60">Mango 3.60</a></li>
				<li><a class="add-to-cart" href="#" data-name="Peach" data-price="2.10">Peach 2.10</a></li>
			</ul>

			<button id="clear-cart">Clear Cart</button>
		</div>

		<div>
			<ul id="show-cart">
				<!-- -->
			</ul>

			<div>Total Cart: $<span id="total-cart"></span></div>
		</div>






		<!-- ******Jquery GOOGLE CDN***** -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<script src="js/main.js"></script>
		<script>

			var myFunctions = {}

			$('.add-to-cart').click(function(event) {
				event.preventDefault()
				var name = $(this).attr('data-name')
				var price = Number($(this).attr('data-price'))

				shoppingCart.addItemToCart(name, price, 1)
				displayCart()
			})

			$('#clear-cart').click(function(event) {
				shoppingCart.clearCart()
				displayCart()
			})

			function displayCart() {
				var cartArray = shoppingCart.listCart()
				var output = ''
				for (var i in cartArray) {
					output += '<li>'
					+cartArray[i].name + ' '
					+ cartArray[i].count
					+ ' x '
					+ cartArray[i].price
					+ ' = '
					+ cartArray[i].total
					+ ' <button class="subtract-item" data-name="'
					+ cartArray[i].name +'"> - </button>'
					+ ' <button class="plus-item" data-name="'
					+ cartArray[i].name +'"> + </button>'
					+ ' <button class="delete-item" data-name="'
					+ cartArray[i].name +'"> X </button>'
					+ '</li>'
				}
				$('#show-cart').html(output)
				$('#total-cart').html( shoppingCart.totalCart() )
			}

			$('#show-cart').on('click', '.delete-item', function(event) {
				var name = $(this).attr('data-name')

				shoppingCart.removeItemFromCartAll(name)
				displayCart()
			})

			$('#show-cart').on('click', '.subtract-item', function(event) {
				var name = $(this).attr('data-name')
				shoppingCart.removeItemFromCart(name)
				displayCart()
			})
			$('#show-cart').on('click', '.plus-item', function(event) {
				var name =$(this).attr('data-name')
				shoppingCart.addItemToCart(name, 0, 1)
				displayCart()
			})



			//********************************************************
			// SHOPPING CART FUNCTIONS

			var shoppingCart = {}

			shoppingCart.cart = []

			shoppingCart.shoppingItem = function(name, price, count) {
				this.name = name,
				this.price = price,
				this.count = count
			}
			//addItemToCart()
			shoppingCart.addItemToCart = function (name, price, count) {
				for (var i in this.cart) {
					if (this.cart[i].name === name) {
						this.cart[i].count += count 
						this.saveCart()
						return
					}
				}
				var item = new this.shoppingItem(name, price, count)
				this.cart.push(item)
				shoppingCart.saveCart()
			}
			//removeITemFromCart(name) // just one item
			shoppingCart.removeItemFromCart = function(name) {
				for (var i in this.cart) {
					if (this.cart[i].name === name) {
						this.cart[i].count --
						if (this.cart[i].count === 0 ) {
							this.cart.splice(i, 1)
						}
						break
					}
				}
				this.saveCart()
			}
			//removeItem FromCartAll(name) //remove all item 
			shoppingCart.removeItemFromCartAll = function(name) {
				for (var i in this.cart) {
					if (this.cart[i].name === name) {
						this.cart.splice(i, 1)
						break
					}

				}
				this.saveCart()
			}
			//clearCart()
			shoppingCart.clearCart = function() {
				this.cart = []
				this.saveCart()
			}
			//countCart() -> return total count
			shoppingCart.countCart = function() {
				var totalCount = 0
				for (var i in this.cart){
					totalCount += this.cart[i].count
				}
				return totalCount
			}
			//totalCart() -> return total cost
			shoppingCart.totalCart = function() {
				var totalCost = 0

				for (var i in this.cart) {
					totalCost += this.cart[i].price * this.cart[i].count
				}
				return totalCost.toFixed(2)
			}
			//listCart()  -> array of Items
			shoppingCart.listCart = function() {
				var cartCopy = []
				for (var i in this.cart) {
					var item = this.cart[i]
					var itemCopy = {}
					for (var p in item) {
						itemCopy[p] = item[p]
					}
					itemCopy.total = (item.price * item.count).toFixed(2)
					cartCopy.push(itemCopy)
				}
				return cartCopy
			}
			//saveCart() -> to check it later -> using local storage 
			shoppingCart.saveCart = function() {
				localStorage.setItem('shoppingCart', JSON.stringify(this.cart))
			}
			//loadCart() -> after saving
			shoppingCart.loadCart = function() {
				this.cart = JSON.parse(localStorage.getItem('shoppingCart'))
			}

			shoppingCart.loadCart()

			displayCart()






			//ListingShelf()

				// to be visable on the UI


		</script>
	</body>
</html>